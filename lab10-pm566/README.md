lab11 SQL
================
Xiaoyu Zhu
11/5/2021

``` r
library(RSQLite)
library(DBI)
library(sqldf)
```

    ## Loading required package: gsubfn

    ## Loading required package: proto

    ## Warning in doTryCatch(return(expr), name, parentenv, handler): unable to load shared object '/Library/Frameworks/R.framework/Resources/modules//R_X11.so':
    ##   dlopen(/Library/Frameworks/R.framework/Resources/modules//R_X11.so, 6): Library not loaded: /opt/X11/lib/libSM.6.dylib
    ##   Referenced from: /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/modules/R_X11.so
    ##   Reason: image not found

    ## Could not load tcltk.  Will use slower R code instead.

``` r
# Initialize a temporary in memory database
con <- dbConnect(SQLite(), ":memory:")

# Download tables
actor <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/actor.csv")
rental <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/rental.csv")
customer <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/customer.csv")
payment <- read.csv("https://raw.githubusercontent.com/ivanceras/sakila/master/csv-sakila-db/payment_p2007_01.csv")

# Copy data.frames to database
dbWriteTable(con, "actor", actor)
dbWriteTable(con, "rental", rental)
dbWriteTable(con, "customer", customer)
dbWriteTable(con, "payment", payment)
```

``` r
dbListTables(con)
```

    ## [1] "actor"    "customer" "payment"  "rental"

IP: Use can use the following QUERY to see the structure of a table

``` r
# PRAGMA table_info(actor)
```

``` r
dbGetQuery(con, "PRAGMA table_info(actor)")
```

    ##   cid        name    type notnull dflt_value pk
    ## 1   0    actor_id INTEGER       0         NA  0
    ## 2   1  first_name    TEXT       0         NA  0
    ## 3   2   last_name    TEXT       0         NA  0
    ## 4   3 last_update    TEXT       0         NA  0

# Exercise 1

### Retrive the actor ID, first name and last name for all actors using the actor table. Sort by last name and then by first name.

``` r
dbGetQuery(con, "
/* This is COMMENT! */
SELECT actor_id, first_name, last_name
FROM actor /* YOU CAN ADD COMMENTS USING
MULTIPLE LINES! */
ORDER by last_name, first_name 
LIMIT 5")
```

    ##   actor_id first_name last_name
    ## 1       58  CHRISTIAN    AKROYD
    ## 2      182     DEBBIE    AKROYD
    ## 3       92    KIRSTEN    AKROYD
    ## 4      118       CUBA     ALLEN
    ## 5      145        KIM     ALLEN

# Exercise 2

### Retrive the actor ID, first name, and last name for actors whose last name equals ‘WILLIAMS’ or ‘DAVIS’.

``` r
dbGetQuery(con, "
/* This is COMMENT! */
SELECT actor_id, first_name, last_name
FROM actor /* YOU CAN ADD COMMENTS USING
MULTIPLE LINES! */
WHERE last_name IN ('WILLIAMS', 'DAVIS')")
```

    ##   actor_id first_name last_name
    ## 1        4   JENNIFER     DAVIS
    ## 2       72       SEAN  WILLIAMS
    ## 3      101      SUSAN     DAVIS
    ## 4      110      SUSAN     DAVIS
    ## 5      137     MORGAN  WILLIAMS
    ## 6      172    GROUCHO  WILLIAMS

# Exercise 3

## Write a query against the rental table that returns the IDs of the customers who rented a film on July 5, 2005 (use the rental.rental\_date column, and you can use the date() function to ignore the time component). Include a single row for each distinct customer ID.

``` r
dbGetQuery(con, "PRAGMA table_info(rental)")
```

    ##   cid         name    type notnull dflt_value pk
    ## 1   0    rental_id INTEGER       0         NA  0
    ## 2   1  rental_date    TEXT       0         NA  0
    ## 3   2 inventory_id INTEGER       0         NA  0
    ## 4   3  customer_id INTEGER       0         NA  0
    ## 5   4  return_date    TEXT       0         NA  0
    ## 6   5     staff_id INTEGER       0         NA  0
    ## 7   6  last_update    TEXT       0         NA  0

``` r
dbGetQuery(con," 
SELECT DISTINCT customer_id 
FROM rental
WHERE date(rental_date) = '2005-07-05' LIMIT 5")
```

    ##   customer_id
    ## 1         565
    ## 2         242
    ## 3          37
    ## 4          60
    ## 5         594

# Exercise 4

## Exercise 4.1

### Construct a query that retrives all rows from the payment table where the amount is either 1.99, 7.99, 9.99.

``` r
q <- dbSendQuery(con, "
SELECT *
FROM payment
WHERE amount IN (1.99, 7.99, 9.99)"
)
dbFetch(q, n = 10)
```

    ##    payment_id customer_id staff_id rental_id amount               payment_date
    ## 1       16050         269        2         7   1.99 2007-01-24 21:40:19.996577
    ## 2       16056         270        1       193   1.99 2007-01-26 05:10:14.996577
    ## 3       16081         282        2        48   1.99 2007-01-25 04:49:12.996577
    ## 4       16103         294        1       595   1.99 2007-01-28 12:28:20.996577
    ## 5       16133         307        1       614   1.99 2007-01-28 14:01:54.996577
    ## 6       16158         316        1      1065   1.99 2007-01-31 07:23:22.996577
    ## 7       16160         318        1       224   9.99 2007-01-26 08:46:53.996577
    ## 8       16161         319        1        15   9.99 2007-01-24 23:07:48.996577
    ## 9       16180         330        2       967   7.99 2007-01-30 17:40:32.996577
    ## 10      16206         351        1      1137   1.99 2007-01-31 17:48:40.996577

``` r
dbFetch(q, n = 10)
```

    ##    payment_id customer_id staff_id rental_id amount               payment_date
    ## 1       16210         354        2       158   1.99 2007-01-25 23:55:37.996577
    ## 2       16240         369        2       913   7.99 2007-01-30 09:33:24.996577
    ## 3       16275         386        1       583   7.99 2007-01-28 10:17:21.996577
    ## 4       16277         387        1       697   7.99 2007-01-29 00:32:30.996577
    ## 5       16289         391        1       891   7.99 2007-01-30 06:11:38.996577
    ## 6       16302         400        2       516   1.99 2007-01-28 01:40:13.996577
    ## 7       16306         401        2       811   1.99 2007-01-29 17:59:08.996577
    ## 8       16307         402        2       801   1.99 2007-01-29 16:04:16.996577
    ## 9       16314         407        1       619   7.99 2007-01-28 14:20:52.996577
    ## 10      16320         411        2       972   1.99 2007-01-30 18:49:33.996577

``` r
dbClearResult(q)
```

## Exercise 4.2

### Construct a query that retrives all rows from the payment table where the amount is greater then 5

``` r
dbGetQuery(con, "
SELECT *
FROM payment
WHERE amount > 5 LIMIT 5")
```

    ##   payment_id customer_id staff_id rental_id amount               payment_date
    ## 1      16052         269        2       678   6.99 2007-01-28 21:44:14.996577
    ## 2      16058         271        1      1096   8.99 2007-01-31 11:59:15.996577
    ## 3      16060         272        1       405   6.99 2007-01-27 12:01:05.996577
    ## 4      16061         272        1      1041   6.99 2007-01-31 04:14:49.996577
    ## 5      16068         274        1       394   5.99 2007-01-27 09:54:37.996577

## Exercise 4.3

### Construct a query that retrives all rows from the payment table where the amount is greater then 5 and less then 8

SELECT \* FROM *** WHERE *** AND \_\_\_

``` r
dbGetQuery(con,"
SELECT staff_id, COUNT(*) AS N
FROM payment
WHERE amount>5
GROUP BY staff_id
")
```

    ##   staff_id   N
    ## 1        1 151
    ## 2        2 115

# Exercise 5

### Retrive all the payment IDs and their amount from the customers whose last name is ‘DAVIS’.

``` r
dbGetQuery(con, "
SELECT p.payment_id, p.amount
FROM payment AS p
  INNER JOIN customer AS c ON p.customer_id = c.customer_id
WHERE c.last_name = 'DAVIS'")
```

    ##   payment_id amount
    ## 1      16685   4.99
    ## 2      16686   2.99
    ## 3      16687   0.99

## Exercise 6.2

### Use COUNT(\*) and GROUP BY to count the number of rentals for each customer\_id

``` r
dbGetQuery(con,"
SELECT COUNT(*) as num_rentals, customer_id
FROM rental
GROUP BY customer_id
")
```

    ##     num_rentals customer_id
    ## 1            32           1
    ## 2            27           2
    ## 3            26           3
    ## 4            22           4
    ## 5            38           5
    ## 6            28           6
    ## 7            33           7
    ## 8            24           8
    ## 9            23           9
    ## 10           25          10
    ## 11           24          11
    ## 12           28          12
    ## 13           27          13
    ## 14           28          14
    ## 15           32          15
    ## 16           28          16
    ## 17           21          17
    ## 18           22          18
    ## 19           24          19
    ## 20           30          20
    ## 21           35          21
    ## 22           22          22
    ## 23           30          23
    ## 24           25          24
    ## 25           29          25
    ## 26           34          26
    ## 27           31          27
    ## 28           32          28
    ## 29           36          29
    ## 30           34          30
    ## 31           26          31
    ## 32           29          32
    ## 33           21          33
    ## 34           24          34
    ## 35           32          35
    ## 36           27          36
    ## 37           23          37
    ## 38           34          38
    ## 39           29          39
    ## 40           27          40
    ## 41           25          41
    ## 42           30          42
    ## 43           24          43
    ## 44           26          44
    ## 45           27          45
    ## 46           34          46
    ## 47           22          47
    ## 48           17          48
    ## 49           28          49
    ## 50           35          50
    ## 51           33          51
    ## 52           29          52
    ## 53           30          53
    ## 54           29          54
    ## 55           22          55
    ## 56           30          56
    ## 57           28          57
    ## 58           27          58
    ## 59           27          59
    ## 60           25          60
    ## 61           14          61
    ## 62           23          62
    ## 63           25          63
    ## 64           33          64
    ## 65           22          65
    ## 66           34          66
    ## 67           22          67
    ## 68           22          68
    ## 69           25          69
    ## 70           18          70
    ## 71           30          71
    ## 72           30          72
    ## 73           24          73
    ## 74           27          74
    ## 75           41          75
    ## 76           23          76
    ## 77           28          77
    ## 78           31          78
    ## 79           22          79
    ## 80           30          80
    ## 81           22          81
    ## 82           26          82
    ## 83           25          83
    ## 84           33          84
    ## 85           23          85
    ## 86           33          86
    ## 87           30          87
    ## 88           21          88
    ## 89           32          89
    ## 90           28          90
    ## 91           35          91
    ## 92           28          92
    ## 93           23          93
    ## 94           21          94
    ## 95           18          95
    ## 96           27          96
    ## 97           18          97
    ## 98           25          98
    ## 99           24          99
    ## 100          24         100
    ## 101          24         101
    ## 102          33         102
    ## 103          31         103
    ## 104          24         104
    ## 105          26         105
    ## 106          23         106
    ## 107          30         107
    ## 108          30         108
    ## 109          26         109
    ## 110          14         110
    ## 111          26         111
    ## 112          30         112
    ## 113          29         113
    ## 114          33         114
    ## 115          30         115
    ## 116          27         116
    ## 117          19         117
    ## 118          21         118
    ## 119          34         119
    ## 120          32         120
    ## 121          26         121
    ## 122          32         122
    ## 123          24         123
    ## 124          18         124
    ## 125          32         125
    ## 126          28         126
    ## 127          24         127
    ## 128          32         128
    ## 129          34         129
    ## 130          24         130
    ## 131          30         131
    ## 132          28         132
    ## 133          27         133
    ## 134          23         134
    ## 135          30         135
    ## 136          15         136
    ## 137          39         137
    ## 138          34         138
    ## 139          27         139
    ## 140          18         140
    ## 141          32         141
    ## 142          26         142
    ## 143          22         143
    ## 144          42         144
    ## 145          28         145
    ## 146          29         146
    ## 147          34         147
    ## 148          46         148
    ## 149          26         149
    ## 150          25         150
    ## 151          27         151
    ## 152          21         152
    ## 153          24         153
    ## 154          30         154
    ## 155          25         155
    ## 156          25         156
    ## 157          31         157
    ## 158          32         158
    ## 159          21         159
    ## 160          27         160
    ## 161          30         161
    ## 162          20         162
    ## 163          29         163
    ## 164          16         164
    ## 165          21         165
    ## 166          28         166
    ## 167          32         167
    ## 168          34         168
    ## 169          22         169
    ## 170          26         170
    ## 171          26         171
    ## 172          33         172
    ## 173          29         173
    ## 174          21         174
    ## 175          24         175
    ## 176          37         176
    ## 177          23         177
    ## 178          39         178
    ## 179          29         179
    ## 180          23         180
    ## 181          34         181
    ## 182          26         182
    ## 183          23         183
    ## 184          23         184
    ## 185          23         185
    ## 186          31         186
    ## 187          28         187
    ## 188          25         188
    ## 189          22         189
    ## 190          27         190
    ## 191          20         191
    ## 192          23         192
    ## 193          25         193
    ## 194          18         194
    ## 195          19         195
    ## 196          35         196
    ## 197          40         197
    ## 198          37         198
    ## 199          25         199
    ## 200          27         200
    ## 201          25         201
    ## 202          26         202
    ## 203          20         203
    ## 204          35         204
    ## 205          18         205
    ## 206          27         206
    ## 207          34         207
    ## 208          26         208
    ## 209          32         209
    ## 210          31         210
    ## 211          34         211
    ## 212          20         212
    ## 213          28         213
    ## 214          31         214
    ## 215          26         215
    ## 216          23         216
    ## 217          23         217
    ## 218          18         218
    ## 219          26         219
    ## 220          27         220
    ## 221          28         221
    ## 222          21         222
    ## 223          17         223
    ## 224          22         224
    ## 225          26         225
    ## 226          21         226
    ## 227          24         227
    ## 228          27         228
    ## 229          25         229
    ## 230          33         230
    ## 231          26         231
    ## 232          25         232
    ## 233          23         233
    ## 234          26         234
    ## 235          25         235
    ## 236          42         236
    ## 237          33         237
    ## 238          21         238
    ## 239          34         239
    ## 240          26         240
    ## 241          34         241
    ## 242          32         242
    ## 243          24         243
    ## 244          32         244
    ## 245          32         245
    ## 246          23         246
    ## 247          22         247
    ## 248          15         248
    ## 249          23         249
    ## 250          20         250
    ## 251          31         251
    ## 252          22         252
    ## 253          29         253
    ## 254          32         254
    ## 255          18         255
    ## 256          30         256
    ## 257          37         257
    ## 258          24         258
    ## 259          32         259
    ## 260          31         260
    ## 261          26         261
    ## 262          28         262
    ## 263          29         263
    ## 264          25         264
    ## 265          29         265
    ## 266          28         266
    ## 267          36         267
    ## 268          29         268
    ## 269          30         269
    ## 270          25         270
    ## 271          18         271
    ## 272          20         272
    ## 273          35         273
    ## 274          35         274
    ## 275          30         275
    ## 276          28         276
    ## 277          32         277
    ## 278          26         278
    ## 279          31         279
    ## 280          27         280
    ## 281          14         281
    ## 282          27         282
    ## 283          28         283
    ## 284          28         284
    ## 285          26         285
    ## 286          27         286
    ## 287          29         287
    ## 288          24         288
    ## 289          30         289
    ## 290          28         290
    ## 291          23         291
    ## 292          27         292
    ## 293          31         293
    ## 294          26         294
    ## 295          38         295
    ## 296          30         296
    ## 297          33         297
    ## 298          26         298
    ## 299          30         299
    ## 300          31         300
    ## 301          21         301
    ## 302          29         302
    ## 303          26         303
    ## 304          26         304
    ## 305          25         305
    ## 306          32         306
    ## 307          30         307
    ## 308          25         308
    ## 309          31         309
    ## 310          20         310
    ## 311          23         311
    ## 312          26         312
    ## 313          23         313
    ## 314          33         314
    ## 315          17         315
    ## 316          29         316
    ## 317          28         317
    ## 318          12         318
    ## 319          30         319
    ## 320          20         320
    ## 321          22         321
    ## 322          28         322
    ## 323          31         323
    ## 324          25         324
    ## 325          22         325
    ## 326          25         326
    ## 327          26         327
    ## 328          23         328
    ## 329          32         329
    ## 330          25         330
    ## 331          27         331
    ## 332          28         332
    ## 333          27         333
    ## 334          30         334
    ## 335          23         335
    ## 336          30         336
    ## 337          29         337
    ## 338          28         338
    ## 339          30         339
    ## 340          31         340
    ## 341          23         341
    ## 342          32         342
    ## 343          25         343
    ## 344          18         344
    ## 345          23         345
    ## 346          32         346
    ## 347          30         347
    ## 348          36         348
    ## 349          29         349
    ## 350          23         350
    ## 351          24         351
    ## 352          23         352
    ## 353          18         353
    ## 354          36         354
    ## 355          20         355
    ## 356          30         356
    ## 357          26         357
    ## 358          21         358
    ## 359          25         359
    ## 360          34         360
    ## 361          31         361
    ## 362          32         362
    ## 363          29         363
    ## 364          23         364
    ## 365          23         365
    ## 366          37         366
    ## 367          22         367
    ## 368          35         368
    ## 369          25         369
    ## 370          19         370
    ## 371          35         371
    ## 372          34         372
    ## 373          35         373
    ## 374          28         374
    ## 375          24         375
    ## 376          28         376
    ## 377          26         377
    ## 378          19         378
    ## 379          23         379
    ## 380          36         380
    ## 381          35         381
    ## 382          24         382
    ## 383          27         383
    ## 384          25         384
    ## 385          26         385
    ## 386          29         386
    ## 387          26         387
    ## 388          30         388
    ## 389          26         389
    ## 390          33         390
    ## 391          30         391
    ## 392          23         392
    ## 393          31         393
    ## 394          22         394
    ## 395          19         395
    ## 396          27         396
    ## 397          29         397
    ## 398          16         398
    ## 399          21         399
    ## 400          28         400
    ## 401          21         401
    ## 402          20         402
    ## 403          35         403
    ## 404          30         404
    ## 405          32         405
    ## 406          32         406
    ## 407          27         407
    ## 408          30         408
    ## 409          23         409
    ## 410          38         410
    ## 411          26         411
    ## 412          21         412
    ## 413          21         413
    ## 414          25         414
    ## 415          23         415
    ## 416          31         416
    ## 417          25         417
    ## 418          30         418
    ## 419          25         419
    ## 420          21         420
    ## 421          27         421
    ## 422          26         422
    ## 423          26         423
    ## 424          30         424
    ## 425          26         425
    ## 426          27         426
    ## 427          24         427
    ## 428          20         428
    ## 429          21         429
    ## 430          22         430
    ## 431          23         431
    ## 432          23         432
    ## 433          25         433
    ## 434          27         434
    ## 435          25         435
    ## 436          30         436
    ## 437          23         437
    ## 438          33         438
    ## 439          36         439
    ## 440          22         440
    ## 441          28         441
    ## 442          32         442
    ## 443          22         443
    ## 444          30         444
    ## 445          26         445
    ## 446          31         446
    ## 447          29         447
    ## 448          29         448
    ## 449          20         449
    ## 450          26         450
    ## 451          33         451
    ## 452          32         452
    ## 453          23         453
    ## 454          33         454
    ## 455          24         455
    ## 456          25         456
    ## 457          28         457
    ## 458          19         458
    ## 459          38         459
    ## 460          25         460
    ## 461          28         461
    ## 462          33         462
    ## 463          25         463
    ## 464          16         464
    ## 465          17         465
    ## 466          23         466
    ## 467          29         467
    ## 468          39         468
    ## 469          40         469
    ## 470          32         470
    ## 471          27         471
    ## 472          30         472
    ## 473          34         473
    ## 474          26         474
    ## 475          24         475
    ## 476          22         476
    ## 477          22         477
    ## 478          19         478
    ## 479          31         479
    ## 480          22         480
    ## 481          29         481
    ## 482          29         482
    ## 483          18         483
    ## 484          30         484
    ## 485          29         485
    ## 486          26         486
    ## 487          26         487
    ## 488          22         488
    ## 489          21         489
    ## 490          24         490
    ## 491          27         491
    ## 492          16         492
    ## 493          23         493
    ## 494          31         494
    ## 495          26         495
    ## 496          21         496
    ## 497          28         497
    ## 498          27         498
    ## 499          30         499
    ## 500          28         500
    ## 501          21         501
    ## 502          34         502
    ## 503          32         503
    ## 504          28         504
    ## 505          21         505
    ## 506          35         506
    ## 507          25         507
    ## 508          25         508
    ## 509          20         509
    ## 510          26         510
    ## 511          24         511
    ## 512          26         512
    ## 513          31         513
    ## 514          22         514
    ## 515          28         515
    ## 516          26         516
    ## 517          25         517
    ## 518          26         518
    ## 519          23         519
    ## 520          32         520
    ## 521          23         521
    ## 522          33         522
    ## 523          22         523
    ## 524          19         524
    ## 525          19         525
    ## 526          45         526
    ## 527          24         527
    ## 528          25         528
    ## 529          29         529
    ## 530          23         530
    ## 531          25         531
    ## 532          32         532
    ## 533          33         533
    ## 534          24         534
    ## 535          32         535
    ## 536          25         536
    ## 537          25         537
    ## 538          29         538
    ## 539          22         539
    ## 540          24         540
    ## 541          24         541
    ## 542          18         542
    ## 543          22         543
    ## 544          22         544
    ## 545          21         545
    ## 546          25         546
    ## 547          23         547
    ## 548          19         548
    ## 549          20         549
    ## 550          32         550
    ## 551          26         551
    ## 552          21         552
    ## 553          24         553
    ## 554          22         554
    ## 555          17         555
    ## 556          21         556
    ## 557          24         557
    ## 558          28         558
    ## 559          28         559
    ## 560          30         560
    ## 561          27         561
    ## 562          25         562
    ## 563          29         563
    ## 564          24         564
    ## 565          29         565
    ## 566          34         566
    ## 567          20         567
    ## 568          21         568
    ## 569          32         569
    ## 570          26         570
    ## 571          24         571
    ## 572          25         572
    ## 573          29         573
    ## 574          28         574
    ## 575          29         575
    ## 576          34         576
    ## 577          27         577
    ## 578          22         578
    ## 579          27         579
    ## 580          27         580
    ## 581          27         581
    ## 582          25         582
    ## 583          23         583
    ## 584          30         584
    ## 585          24         585
    ## 586          19         586
    ## 587          26         587
    ## 588          29         588
    ## 589          28         589
    ## 590          25         590
    ## 591          27         591
    ## 592          29         592
    ## 593          26         593
    ## 594          27         594
    ## 595          30         595
    ## 596          28         596
    ## 597          25         597
    ## 598          22         598
    ## 599          19         599

## Exercise 6.3

``` r
dbGetQuery(con,"
SELECT COUNT(*) AS num_rentals, customer_id
FROM rental
GROUP BY customer_id
ORDER BY num_rentals DESC
")
```

    ##     num_rentals customer_id
    ## 1            46         148
    ## 2            45         526
    ## 3            42         236
    ## 4            42         144
    ## 5            41          75
    ## 6            40         469
    ## 7            40         197
    ## 8            39         468
    ## 9            39         178
    ## 10           39         137
    ## 11           38         459
    ## 12           38         410
    ## 13           38         295
    ## 14           38           5
    ## 15           37         366
    ## 16           37         257
    ## 17           37         198
    ## 18           37         176
    ## 19           36         439
    ## 20           36         380
    ## 21           36         354
    ## 22           36         348
    ## 23           36         267
    ## 24           36          29
    ## 25           35         506
    ## 26           35         403
    ## 27           35         381
    ## 28           35         373
    ## 29           35         371
    ## 30           35         368
    ## 31           35         274
    ## 32           35         273
    ## 33           35         204
    ## 34           35         196
    ## 35           35          91
    ## 36           35          50
    ## 37           35          21
    ## 38           34         576
    ## 39           34         566
    ## 40           34         502
    ## 41           34         473
    ## 42           34         372
    ## 43           34         360
    ## 44           34         241
    ## 45           34         239
    ## 46           34         211
    ## 47           34         207
    ## 48           34         181
    ## 49           34         168
    ## 50           34         147
    ## 51           34         138
    ## 52           34         129
    ## 53           34         119
    ## 54           34          66
    ## 55           34          46
    ## 56           34          38
    ## 57           34          30
    ## 58           34          26
    ## 59           33         533
    ## 60           33         522
    ## 61           33         462
    ## 62           33         454
    ## 63           33         451
    ## 64           33         438
    ## 65           33         390
    ## 66           33         314
    ## 67           33         297
    ## 68           33         237
    ## 69           33         230
    ## 70           33         172
    ## 71           33         114
    ## 72           33         102
    ## 73           33          86
    ## 74           33          84
    ## 75           33          64
    ## 76           33          51
    ## 77           33           7
    ## 78           32         569
    ## 79           32         550
    ## 80           32         535
    ## 81           32         532
    ## 82           32         520
    ## 83           32         503
    ## 84           32         470
    ## 85           32         452
    ## 86           32         442
    ## 87           32         406
    ## 88           32         405
    ## 89           32         362
    ## 90           32         346
    ## 91           32         342
    ## 92           32         329
    ## 93           32         306
    ## 94           32         277
    ## 95           32         259
    ## 96           32         254
    ## 97           32         245
    ## 98           32         244
    ## 99           32         242
    ## 100          32         209
    ## 101          32         167
    ## 102          32         158
    ## 103          32         141
    ## 104          32         128
    ## 105          32         125
    ## 106          32         122
    ## 107          32         120
    ## 108          32          89
    ## 109          32          35
    ## 110          32          28
    ## 111          32          15
    ## 112          32           1
    ## 113          31         513
    ## 114          31         494
    ## 115          31         479
    ## 116          31         446
    ## 117          31         416
    ## 118          31         393
    ## 119          31         361
    ## 120          31         340
    ## 121          31         323
    ## 122          31         309
    ## 123          31         300
    ## 124          31         293
    ## 125          31         279
    ## 126          31         260
    ## 127          31         251
    ## 128          31         214
    ## 129          31         210
    ## 130          31         186
    ## 131          31         157
    ## 132          31         103
    ## 133          31          78
    ## 134          31          27
    ## 135          30         595
    ## 136          30         584
    ## 137          30         560
    ## 138          30         499
    ## 139          30         484
    ## 140          30         472
    ## 141          30         444
    ## 142          30         436
    ## 143          30         424
    ## 144          30         418
    ## 145          30         408
    ## 146          30         404
    ## 147          30         391
    ## 148          30         388
    ## 149          30         356
    ## 150          30         347
    ## 151          30         339
    ## 152          30         336
    ## 153          30         334
    ## 154          30         319
    ## 155          30         307
    ## 156          30         299
    ## 157          30         296
    ## 158          30         289
    ## 159          30         275
    ## 160          30         269
    ## 161          30         256
    ## 162          30         161
    ## 163          30         154
    ## 164          30         135
    ## 165          30         131
    ## 166          30         115
    ## 167          30         112
    ## 168          30         108
    ## 169          30         107
    ## 170          30          87
    ## 171          30          80
    ## 172          30          72
    ## 173          30          71
    ## 174          30          56
    ## 175          30          53
    ## 176          30          42
    ## 177          30          23
    ## 178          30          20
    ## 179          29         592
    ## 180          29         588
    ## 181          29         575
    ## 182          29         573
    ## 183          29         565
    ## 184          29         563
    ## 185          29         538
    ## 186          29         529
    ## 187          29         485
    ## 188          29         482
    ## 189          29         481
    ## 190          29         467
    ## 191          29         448
    ## 192          29         447
    ## 193          29         397
    ## 194          29         386
    ## 195          29         363
    ## 196          29         349
    ## 197          29         337
    ## 198          29         316
    ## 199          29         302
    ## 200          29         287
    ## 201          29         268
    ## 202          29         265
    ## 203          29         263
    ## 204          29         253
    ## 205          29         179
    ## 206          29         173
    ## 207          29         163
    ## 208          29         146
    ## 209          29         113
    ## 210          29          54
    ## 211          29          52
    ## 212          29          39
    ## 213          29          32
    ## 214          29          25
    ## 215          28         596
    ## 216          28         589
    ## 217          28         574
    ## 218          28         559
    ## 219          28         558
    ## 220          28         515
    ## 221          28         504
    ## 222          28         500
    ## 223          28         497
    ## 224          28         461
    ## 225          28         457
    ## 226          28         441
    ## 227          28         400
    ## 228          28         376
    ## 229          28         374
    ## 230          28         338
    ## 231          28         332
    ## 232          28         322
    ## 233          28         317
    ## 234          28         290
    ## 235          28         284
    ## 236          28         283
    ## 237          28         276
    ## 238          28         266
    ## 239          28         262
    ## 240          28         221
    ## 241          28         213
    ## 242          28         187
    ## 243          28         166
    ## 244          28         145
    ## 245          28         132
    ## 246          28         126
    ## 247          28          92
    ## 248          28          90
    ## 249          28          77
    ## 250          28          57
    ## 251          28          49
    ## 252          28          16
    ## 253          28          14
    ## 254          28          12
    ## 255          28           6
    ## 256          27         594
    ## 257          27         591
    ## 258          27         581
    ## 259          27         580
    ## 260          27         579
    ## 261          27         577
    ## 262          27         561
    ## 263          27         498
    ## 264          27         491
    ## 265          27         471
    ## 266          27         434
    ## 267          27         426
    ## 268          27         421
    ## 269          27         407
    ## 270          27         396
    ## 271          27         383
    ## 272          27         333
    ## 273          27         331
    ## 274          27         292
    ## 275          27         286
    ## 276          27         282
    ## 277          27         280
    ## 278          27         228
    ## 279          27         220
    ## 280          27         206
    ## 281          27         200
    ## 282          27         190
    ## 283          27         160
    ## 284          27         151
    ## 285          27         139
    ## 286          27         133
    ## 287          27         116
    ## 288          27          96
    ## 289          27          74
    ## 290          27          59
    ## 291          27          58
    ## 292          27          45
    ## 293          27          40
    ## 294          27          36
    ## 295          27          13
    ## 296          27           2
    ## 297          26         593
    ## 298          26         587
    ## 299          26         570
    ## 300          26         551
    ## 301          26         518
    ## 302          26         516
    ## 303          26         512
    ## 304          26         510
    ## 305          26         495
    ## 306          26         487
    ## 307          26         486
    ## 308          26         474
    ## 309          26         450
    ## 310          26         445
    ## 311          26         425
    ## 312          26         423
    ## 313          26         422
    ## 314          26         411
    ## 315          26         389
    ## 316          26         387
    ## 317          26         385
    ## 318          26         377
    ## 319          26         357
    ## 320          26         327
    ## 321          26         312
    ## 322          26         304
    ## 323          26         303
    ## 324          26         298
    ## 325          26         294
    ## 326          26         285
    ## 327          26         278
    ## 328          26         261
    ## 329          26         240
    ## 330          26         234
    ## 331          26         231
    ## 332          26         225
    ## 333          26         219
    ## 334          26         215
    ## 335          26         208
    ## 336          26         202
    ## 337          26         182
    ## 338          26         171
    ## 339          26         170
    ## 340          26         149
    ## 341          26         142
    ## 342          26         121
    ## 343          26         111
    ## 344          26         109
    ## 345          26         105
    ## 346          26          82
    ## 347          26          44
    ## 348          26          31
    ## 349          26           3
    ## 350          25         597
    ## 351          25         590
    ## 352          25         582
    ## 353          25         572
    ## 354          25         562
    ## 355          25         546
    ## 356          25         537
    ## 357          25         536
    ## 358          25         531
    ## 359          25         528
    ## 360          25         517
    ## 361          25         508
    ## 362          25         507
    ## 363          25         463
    ## 364          25         460
    ## 365          25         456
    ## 366          25         435
    ## 367          25         433
    ## 368          25         419
    ## 369          25         417
    ## 370          25         414
    ## 371          25         384
    ## 372          25         369
    ## 373          25         359
    ## 374          25         343
    ## 375          25         330
    ## 376          25         326
    ## 377          25         324
    ## 378          25         308
    ## 379          25         305
    ## 380          25         270
    ## 381          25         264
    ## 382          25         235
    ## 383          25         232
    ## 384          25         229
    ## 385          25         201
    ## 386          25         199
    ## 387          25         193
    ## 388          25         188
    ## 389          25         156
    ## 390          25         155
    ## 391          25         150
    ## 392          25          98
    ## 393          25          83
    ## 394          25          69
    ## 395          25          63
    ## 396          25          60
    ## 397          25          41
    ## 398          25          24
    ## 399          25          10
    ## 400          24         585
    ## 401          24         571
    ## 402          24         564
    ## 403          24         557
    ## 404          24         553
    ## 405          24         541
    ## 406          24         540
    ## 407          24         534
    ## 408          24         527
    ## 409          24         511
    ## 410          24         490
    ## 411          24         475
    ## 412          24         455
    ## 413          24         427
    ## 414          24         382
    ## 415          24         375
    ## 416          24         351
    ## 417          24         288
    ## 418          24         258
    ## 419          24         243
    ## 420          24         227
    ## 421          24         175
    ## 422          24         153
    ## 423          24         130
    ## 424          24         127
    ## 425          24         123
    ## 426          24         104
    ## 427          24         101
    ## 428          24         100
    ## 429          24          99
    ## 430          24          73
    ## 431          24          43
    ## 432          24          34
    ## 433          24          19
    ## 434          24          11
    ## 435          24           8
    ## 436          23         583
    ## 437          23         547
    ## 438          23         530
    ## 439          23         521
    ## 440          23         519
    ## 441          23         493
    ## 442          23         466
    ## 443          23         453
    ## 444          23         437
    ## 445          23         432
    ## 446          23         431
    ## 447          23         415
    ## 448          23         409
    ## 449          23         392
    ## 450          23         379
    ## 451          23         365
    ## 452          23         364
    ## 453          23         352
    ## 454          23         350
    ## 455          23         345
    ## 456          23         341
    ## 457          23         335
    ## 458          23         328
    ## 459          23         313
    ## 460          23         311
    ## 461          23         291
    ## 462          23         249
    ## 463          23         246
    ## 464          23         233
    ## 465          23         217
    ## 466          23         216
    ## 467          23         192
    ## 468          23         185
    ## 469          23         184
    ## 470          23         183
    ## 471          23         180
    ## 472          23         177
    ## 473          23         134
    ## 474          23         106
    ## 475          23          93
    ## 476          23          85
    ## 477          23          76
    ## 478          23          62
    ## 479          23          37
    ## 480          23           9
    ## 481          22         598
    ## 482          22         578
    ## 483          22         554
    ## 484          22         544
    ## 485          22         543
    ## 486          22         539
    ## 487          22         523
    ## 488          22         514
    ## 489          22         488
    ## 490          22         480
    ## 491          22         477
    ## 492          22         476
    ## 493          22         443
    ## 494          22         440
    ## 495          22         430
    ## 496          22         394
    ## 497          22         367
    ## 498          22         325
    ## 499          22         321
    ## 500          22         252
    ## 501          22         247
    ## 502          22         224
    ## 503          22         189
    ## 504          22         169
    ## 505          22         143
    ## 506          22          81
    ## 507          22          79
    ## 508          22          68
    ## 509          22          67
    ## 510          22          65
    ## 511          22          55
    ## 512          22          47
    ## 513          22          22
    ## 514          22          18
    ## 515          22           4
    ## 516          21         568
    ## 517          21         556
    ## 518          21         552
    ## 519          21         545
    ## 520          21         505
    ## 521          21         501
    ## 522          21         496
    ## 523          21         489
    ## 524          21         429
    ## 525          21         420
    ## 526          21         413
    ## 527          21         412
    ## 528          21         401
    ## 529          21         399
    ## 530          21         358
    ## 531          21         301
    ## 532          21         238
    ## 533          21         226
    ## 534          21         222
    ## 535          21         174
    ## 536          21         165
    ## 537          21         159
    ## 538          21         152
    ## 539          21         118
    ## 540          21          94
    ## 541          21          88
    ## 542          21          33
    ## 543          21          17
    ## 544          20         567
    ## 545          20         549
    ## 546          20         509
    ## 547          20         449
    ## 548          20         428
    ## 549          20         402
    ## 550          20         355
    ## 551          20         320
    ## 552          20         310
    ## 553          20         272
    ## 554          20         250
    ## 555          20         212
    ## 556          20         203
    ## 557          20         191
    ## 558          20         162
    ## 559          19         599
    ## 560          19         586
    ## 561          19         548
    ## 562          19         525
    ## 563          19         524
    ## 564          19         478
    ## 565          19         458
    ## 566          19         395
    ## 567          19         378
    ## 568          19         370
    ## 569          19         195
    ## 570          19         117
    ## 571          18         542
    ## 572          18         483
    ## 573          18         353
    ## 574          18         344
    ## 575          18         271
    ## 576          18         255
    ## 577          18         218
    ## 578          18         205
    ## 579          18         194
    ## 580          18         140
    ## 581          18         124
    ## 582          18          97
    ## 583          18          95
    ## 584          18          70
    ## 585          17         555
    ## 586          17         465
    ## 587          17         315
    ## 588          17         223
    ## 589          17          48
    ## 590          16         492
    ## 591          16         464
    ## 592          16         398
    ## 593          16         164
    ## 594          15         248
    ## 595          15         136
    ## 596          14         281
    ## 597          14         110
    ## 598          14          61
    ## 599          12         318

## Exercise 6.4

### Repeat the previous query but use HAVING to only keep the groups with 40 or more.

``` r
dbGetQuery(con,"
SELECT COUNT(*) AS num_rentals, customer_id
FROM rental
GROUP BY customer_id
HAVING num_rentals >= 40
ORDER BY num_rentals DESC
")
```

    ##   num_rentals customer_id
    ## 1          46         148
    ## 2          45         526
    ## 3          42         236
    ## 4          42         144
    ## 5          41          75
    ## 6          40         469
    ## 7          40         197

# Exercise 7

### The following query calculates a number of summary statistics for the payment table using MAX, MIN, AVG and SUM

``` r
dbGetQuery(con,"
SELECT MAX(amount) as max,
       MIN(amount) as min,
       AVG(amount) as avg,
       SUM(amount) as sum,
       customer_id
FROM payment
LIMIT 5
")
```

    ##     max  min      avg     sum customer_id
    ## 1 11.99 0.99 4.169775 4824.43         269

## Exercise 7.1

### Modify the above query to do those calculations for each customer\_id

``` r
dbGetQuery(con,"
SELECT MAX(amount) as max,
       MIN(amount) as min,
       AVG(amount) as avg,
       SUM(amount) as sum,
       customer_id
FROM payment
GROUP BY customer_id
")
```

    ##       max  min      avg   sum customer_id
    ## 1    2.99 0.99 1.990000  3.98           1
    ## 2    4.99 4.99 4.990000  4.99           2
    ## 3    2.99 1.99 2.490000  4.98           3
    ## 4    6.99 0.99 3.323333  9.97           5
    ## 5    4.99 0.99 2.990000  8.97           6
    ## 6    5.99 0.99 4.190000 20.95           7
    ## 7    6.99 6.99 6.990000  6.99           8
    ## 8    4.99 0.99 3.656667 10.97           9
    ## 9    4.99 4.99 4.990000  4.99          10
    ## 10   6.99 6.99 6.990000  6.99          11
    ## 11   4.99 4.99 4.990000  9.98          12
    ## 12   9.99 0.99 4.190000 20.95          14
    ## 13   3.99 0.99 2.740000 10.96          16
    ## 14   4.99 2.99 3.656667 10.97          17
    ## 15   4.99 2.99 4.323333 12.97          18
    ## 16   9.99 0.99 4.490000 26.94          19
    ## 17   6.99 1.99 3.990000 11.97          20
    ## 18   3.99 0.99 2.990000  8.97          21
    ## 19   8.99 4.99 6.323333 18.97          22
    ## 20   8.99 0.99 4.323333 12.97          23
    ## 21   6.99 2.99 4.990000  9.98          24
    ## 22   7.99 2.99 5.490000 10.98          25
    ## 23   2.99 2.99 2.990000  5.98          26
    ## 24   2.99 2.99 2.990000  2.99          27
    ## 25   2.99 2.99 2.990000  5.98          28
    ## 26   1.99 1.99 1.990000  1.99          29
    ## 27   4.99 4.99 4.990000 14.97          32
    ## 28   2.99 2.99 2.990000  2.99          33
    ## 29   6.99 3.99 5.490000 10.98          35
    ## 30   0.99 0.99 0.990000  1.98          36
    ## 31   2.99 0.99 1.990000  3.98          37
    ## 32   4.99 4.99 4.990000  4.99          40
    ## 33   5.99 5.99 5.990000  5.99          42
    ## 34   4.99 4.99 4.990000  9.98          43
    ## 35   4.99 0.99 2.590000 12.95          44
    ## 36   2.99 2.99 2.990000  2.99          45
    ## 37   4.99 2.99 3.656667 10.97          46
    ## 38   6.99 3.99 5.323333 15.97          47
    ## 39   4.99 0.99 2.990000  8.97          48
    ## 40   4.99 1.99 3.490000 13.96          49
    ## 41   4.99 4.99 4.990000 24.95          50
    ## 42   4.99 4.99 4.990000 14.97          51
    ## 43   0.99 0.99 0.990000  0.99          52
    ## 44   9.99 0.99 4.490000 26.94          53
    ## 45   4.99 3.99 4.656667 13.97          54
    ## 46   9.99 0.99 5.323333 15.97          55
    ## 47   6.99 2.99 4.990000 19.96          56
    ## 48   9.99 4.99 7.490000 14.98          57
    ## 49   7.99 0.99 3.323333  9.97          58
    ## 50   5.99 2.99 4.656667 13.97          59
    ## 51   4.99 1.99 3.323333  9.97          60
    ## 52   0.99 0.99 0.990000  0.99          61
    ## 53   4.99 0.99 2.990000  5.98          62
    ## 54   4.99 0.99 2.990000  8.97          64
    ## 55   4.99 0.99 2.990000  5.98          65
    ## 56   4.99 4.99 4.990000  4.99          66
    ## 57   9.99 2.99 6.490000 12.98          67
    ## 58   4.99 1.99 3.490000  6.98          69
    ## 59   4.99 4.99 4.990000  4.99          70
    ## 60   9.99 2.99 6.490000 12.98          71
    ## 61   4.99 0.99 3.656667 10.97          72
    ## 62   4.99 2.99 3.990000  7.98          73
    ## 63   6.99 6.99 6.990000  6.99          74
    ## 64   4.99 0.99 2.990000  5.98          75
    ## 65   1.99 0.99 1.490000  2.98          76
    ## 66   5.99 0.99 2.990000 14.95          77
    ## 67   4.99 2.99 3.656667 10.97          79
    ## 68   0.99 0.99 0.990000  0.99          81
    ## 69   8.99 2.99 5.990000 11.98          82
    ## 70   2.99 0.99 1.656667  4.97          83
    ## 71   6.99 0.99 4.323333 12.97          84
    ## 72   9.99 4.99 7.490000 14.98          85
    ## 73   1.99 1.99 1.990000  1.99          86
    ## 74   4.99 2.99 3.990000  7.98          87
    ## 75   2.99 2.99 2.990000  2.99          88
    ## 76   5.99 0.99 3.323333  9.97          89
    ## 77   5.99 5.99 5.990000  5.99          91
    ## 78   5.99 4.99 5.490000 10.98          92
    ## 79   6.99 2.99 4.990000 14.97          93
    ## 80   4.99 2.99 3.990000  7.98          94
    ## 81   4.99 4.99 4.990000  4.99          95
    ## 82   3.99 3.99 3.990000  3.99          98
    ## 83   0.99 0.99 0.990000  0.99          99
    ## 84   0.99 0.99 0.990000  0.99         100
    ## 85   9.99 9.99 9.990000  9.99         101
    ## 86   4.99 0.99 2.656667  7.97         102
    ## 87   9.99 7.99 8.990000 17.98         103
    ## 88  10.99 3.99 7.490000 14.98         104
    ## 89   8.99 2.99 6.740000 26.96         105
    ## 90   3.99 0.99 2.490000  4.98         106
    ## 91   5.99 5.99 5.990000 11.98         107
    ## 92   4.99 0.99 2.990000  5.98         108
    ## 93   7.99 0.99 3.990000 27.93         109
    ## 94   7.99 1.99 4.990000  9.98         110
    ## 95   2.99 2.99 2.990000  2.99         111
    ## 96   2.99 0.99 1.990000  3.98         112
    ## 97   0.99 0.99 0.990000  1.98         113
    ## 98   4.99 2.99 4.323333 12.97         114
    ## 99   2.99 0.99 1.656667  4.97         115
    ## 100  4.99 4.99 4.990000  4.99         116
    ## 101  0.99 0.99 0.990000  1.98         117
    ## 102  5.99 5.99 5.990000  5.99         118
    ## 103  6.99 0.99 4.656667 13.97         119
    ## 104  7.99 0.99 4.490000  8.98         120
    ## 105  4.99 4.99 4.990000  4.99         121
    ## 106  4.99 0.99 2.990000  5.98         122
    ## 107  2.99 2.99 2.990000  2.99         123
    ## 108  5.99 0.99 3.990000 15.96         124
    ## 109  3.99 3.99 3.990000  3.99         125
    ## 110  4.99 4.99 4.990000 14.97         126
    ## 111  0.99 0.99 0.990000  1.98         127
    ## 112  5.99 2.99 4.490000  8.98         128
    ## 113  2.99 2.99 2.990000  5.98         130
    ## 114  7.99 2.99 5.323333 15.97         131
    ## 115  6.99 2.99 4.990000  9.98         133
    ## 116  6.99 0.99 4.240000 16.96         134
    ## 117  5.99 3.99 4.990000  9.98         135
    ## 118  2.99 2.99 2.990000  2.99         136
    ## 119  2.99 2.99 2.990000  2.99         137
    ## 120  2.99 0.99 1.990000  3.98         138
    ## 121  2.99 2.99 2.990000  2.99         141
    ## 122  9.99 0.99 6.656667 19.97         142
    ## 123  2.99 2.99 2.990000  5.98         143
    ## 124  2.99 2.99 2.990000  5.98         144
    ## 125  0.99 0.99 0.990000  0.99         145
    ## 126  7.99 4.99 6.490000 12.98         146
    ## 127  0.99 0.99 0.990000  1.98         147
    ## 128  4.99 4.99 4.990000  4.99         148
    ## 129  4.99 4.99 4.990000  4.99         149
    ## 130  3.99 2.99 3.656667 10.97         150
    ## 131  5.99 4.99 5.490000 10.98         151
    ## 132  4.99 4.99 4.990000  9.98         152
    ## 133  7.99 5.99 6.656667 19.97         154
    ## 134  2.99 2.99 2.990000  2.99         155
    ## 135  6.99 4.99 5.990000 11.98         156
    ## 136  4.99 0.99 2.990000  5.98         157
    ## 137  5.99 4.99 5.490000 10.98         158
    ## 138  3.99 0.99 2.490000  9.96         159
    ## 139  5.99 0.99 2.990000 17.94         161
    ## 140  4.99 1.99 3.990000 11.97         162
    ## 141  1.99 1.99 1.990000  1.99         164
    ## 142  4.99 4.99 4.990000  4.99         165
    ## 143  1.99 1.99 1.990000  1.99         166
    ## 144  4.99 2.99 3.656667 10.97         167
    ## 145  4.99 0.99 2.990000  5.98         168
    ## 146  4.99 3.99 4.490000  8.98         169
    ## 147  5.99 0.99 3.323333  9.97         170
    ## 148  9.99 9.99 9.990000  9.99         171
    ## 149  6.99 0.99 3.990000 11.97         172
    ## 150  4.99 2.99 3.990000  7.98         173
    ## 151  5.99 4.99 5.490000 10.98         174
    ## 152  7.99 0.99 4.390000 21.95         176
    ## 153  6.99 0.99 4.323333 12.97         179
    ## 154  2.99 2.99 2.990000  2.99         180
    ## 155  6.99 6.99 6.990000  6.99         181
    ## 156  3.99 0.99 2.490000  4.98         182
    ## 157  0.99 0.99 0.990000  0.99         183
    ## 158  4.99 1.99 3.323333  9.97         184
    ## 159  2.99 0.99 1.656667  4.97         185
    ## 160  1.99 0.99 1.490000  2.98         186
    ## 161  7.99 7.99 7.990000  7.99         187
    ## 162  5.99 5.99 5.990000  5.99         189
    ## 163  4.99 2.99 3.990000  7.98         190
    ## 164  4.99 2.99 3.990000  7.98         191
    ## 165  1.99 1.99 1.990000  1.99         192
    ## 166  2.99 0.99 1.990000  3.98         193
    ## 167  7.99 4.99 6.490000 12.98         194
    ## 168 11.99 1.99 5.740000 22.96         196
    ## 169  3.99 0.99 2.615000 20.92         197
    ## 170  4.99 0.99 3.390000 16.95         198
    ## 171  7.99 7.99 7.990000  7.99         199
    ## 172  9.99 9.99 9.990000  9.99         200
    ## 173  6.99 3.99 5.656667 16.97         201
    ## 174  0.99 0.99 0.990000  0.99         203
    ## 175  4.99 0.99 3.240000 12.96         204
    ## 176  6.99 0.99 2.990000 17.94         207
    ## 177  4.99 4.99 4.990000  4.99         208
    ## 178  9.99 0.99 4.656667 13.97         209
    ## 179  2.99 2.99 2.990000  2.99         210
    ## 180  4.99 4.99 4.990000  4.99         211
    ## 181  0.99 0.99 0.990000  0.99         213
    ## 182  3.99 0.99 2.590000 12.95         214
    ## 183  4.99 4.99 4.990000  9.98         215
    ## 184  4.99 4.99 4.990000  4.99         216
    ## 185  8.99 2.99 5.990000 11.98         217
    ## 186  0.99 0.99 0.990000  0.99         219
    ## 187  3.99 0.99 2.490000  4.98         220
    ## 188  4.99 4.99 4.990000  4.99         221
    ## 189  6.99 0.99 3.990000 19.95         222
    ## 190  2.99 2.99 2.990000  2.99         223
    ## 191  4.99 3.99 4.490000  8.98         225
    ## 192  4.99 3.99 4.490000  8.98         227
    ## 193  4.99 0.99 2.990000  5.98         228
    ## 194  4.99 0.99 2.990000  5.98         230
    ## 195  8.99 5.99 7.323333 21.97         231
    ## 196  4.99 3.99 4.490000  8.98         232
    ## 197  4.99 4.99 4.990000  4.99         234
    ## 198  2.99 0.99 1.990000  3.98         235
    ## 199  2.99 2.99 2.990000  8.97         236
    ## 200  4.99 0.99 2.990000  5.98         237
    ## 201  4.99 2.99 3.990000  7.98         238
    ## 202  7.99 2.99 5.656667 33.94         239
    ## 203  4.99 2.99 3.656667 10.97         240
    ## 204  7.99 3.99 5.990000 11.98         241
    ## 205  4.99 2.99 3.990000 11.97         242
    ## 206  4.99 4.99 4.990000  4.99         243
    ## 207  4.99 1.99 3.490000  6.98         244
    ## 208  8.99 0.99 4.823333 28.94         245
    ## 209  8.99 3.99 6.190000 30.95         246
    ## 210  6.99 3.99 5.323333 15.97         247
    ## 211  7.99 4.99 6.490000 12.98         248
    ## 212  6.99 2.99 4.740000 18.96         249
    ## 213  5.99 0.99 3.790000 18.95         250
    ## 214  4.99 1.99 3.323333 19.94         251
    ## 215  4.99 0.99 2.990000  5.98         252
    ## 216  6.99 0.99 3.656667 10.97         253
    ## 217  5.99 2.99 4.490000  8.98         254
    ## 218  4.99 0.99 2.990000 14.95         256
    ## 219  2.99 2.99 2.990000  8.97         257
    ## 220  6.99 2.99 5.323333 15.97         259
    ## 221  8.99 8.99 8.990000  8.99         260
    ## 222  6.99 0.99 4.240000 16.96         261
    ## 223  4.99 4.99 4.990000  4.99         262
    ## 224  4.99 0.99 2.990000  5.98         263
    ## 225  0.99 0.99 0.990000  0.99         265
    ## 226  2.99 1.99 2.490000  4.98         266
    ## 227  6.99 4.99 5.656667 16.97         267
    ## 228  6.99 0.99 3.156667 18.94         269
    ## 229  4.99 1.99 3.490000  6.98         270
    ## 230  8.99 8.99 8.990000  8.99         271
    ## 231  6.99 0.99 3.990000 15.96         272
    ## 232  3.99 0.99 2.490000  4.98         273
    ## 233  5.99 2.99 4.156667 24.94         274
    ## 234  2.99 2.99 2.990000  2.99         275
    ## 235 10.99 3.99 7.490000 14.98         276
    ## 236  6.99 6.99 6.990000  6.99         277
    ## 237  4.99 4.99 4.990000  4.99         278
    ## 238  2.99 0.99 1.990000  3.98         279
    ## 239  4.99 4.99 4.990000  4.99         280
    ## 240  2.99 2.99 2.990000  5.98         281
    ## 241  6.99 0.99 3.323333  9.97         282
    ## 242  6.99 0.99 2.990000  8.97         284
    ## 243  6.99 6.99 6.990000  6.99         286
    ## 244  2.99 0.99 2.323333  6.97         287
    ## 245  6.99 3.99 5.490000 21.96         288
    ## 246  2.99 2.99 2.990000  2.99         290
    ## 247  4.99 2.99 4.323333 12.97         291
    ## 248  0.99 0.99 0.990000  0.99         292
    ## 249  8.99 0.99 4.990000 14.97         293
    ## 250  1.99 1.99 1.990000  1.99         294
    ## 251  3.99 3.99 3.990000  3.99         295
    ## 252  5.99 2.99 4.740000 18.96         296
    ## 253  3.99 0.99 2.490000  4.98         297
    ## 254  3.99 3.99 3.990000  3.99         298
    ## 255  8.99 5.99 7.490000 14.98         299
    ## 256  4.99 0.99 3.323333  9.97         300
    ## 257  5.99 0.99 3.990000 11.97         301
    ## 258  5.99 4.99 5.490000 10.98         302
    ## 259  4.99 0.99 2.990000  8.97         303
    ## 260 10.99 0.99 4.990000 14.97         304
    ## 261  2.99 2.99 2.990000  2.99         305
    ## 262  6.99 3.99 5.490000 10.98         306
    ## 263  6.99 1.99 4.740000 18.96         307
    ## 264  3.99 3.99 3.990000  3.99         308
    ## 265  6.99 0.99 3.990000  7.98         309
    ## 266  0.99 0.99 0.990000  0.99         310
    ## 267  6.99 2.99 5.390000 26.95         311
    ## 268  6.99 0.99 4.490000 17.96         312
    ## 269  4.99 0.99 2.490000  9.96         313
    ## 270  5.99 4.99 5.490000 10.98         314
    ## 271  8.99 4.99 6.990000 13.98         315
    ## 272  8.99 1.99 5.323333 15.97         316
    ## 273  6.99 6.99 6.990000  6.99         317
    ## 274  9.99 9.99 9.990000  9.99         318
    ## 275  9.99 2.99 5.656667 16.97         319
    ## 276  5.99 4.99 5.323333 15.97         321
    ## 277  4.99 0.99 2.990000  5.98         322
    ## 278  5.99 2.99 4.656667 13.97         323
    ## 279  3.99 3.99 3.990000  3.99         324
    ## 280  5.99 5.99 5.990000  5.99         325
    ## 281  6.99 3.99 5.323333 15.97         326
    ## 282  6.99 6.99 6.990000  6.99         327
    ## 283  2.99 2.99 2.990000  2.99         328
    ## 284  7.99 3.99 5.990000 11.98         330
    ## 285  2.99 0.99 1.990000  3.98         331
    ## 286  6.99 3.99 5.490000 10.98         332
    ## 287  4.99 4.99 4.990000  4.99         333
    ## 288  8.99 6.99 7.990000 15.98         334
    ## 289  8.99 4.99 6.990000 20.97         337
    ## 290  0.99 0.99 0.990000  0.99         338
    ## 291  5.99 5.99 5.990000  5.99         339
    ## 292  3.99 3.99 3.990000  7.98         343
    ## 293  5.99 2.99 4.490000  8.98         344
    ## 294  0.99 0.99 0.990000  1.98         345
    ## 295  4.99 4.99 4.990000  9.98         346
    ## 296  0.99 0.99 0.990000  1.98         348
    ## 297  4.99 4.99 4.990000  4.99         349
    ## 298  4.99 4.99 4.990000  9.98         350
    ## 299  1.99 1.99 1.990000  1.99         351
    ## 300  2.99 2.99 2.990000  2.99         352
    ## 301  6.99 6.99 6.990000  6.99         353
    ## 302  1.99 0.99 1.323333  3.97         354
    ## 303  3.99 3.99 3.990000  3.99         355
    ## 304  4.99 4.99 4.990000  4.99         356
    ## 305  4.99 0.99 2.990000  8.97         357
    ## 306  4.99 4.99 4.990000  4.99         358
    ## 307  8.99 2.99 5.323333 15.97         359
    ## 308  4.99 0.99 2.990000  5.98         360
    ## 309  5.99 4.99 5.490000 10.98         361
    ## 310  4.99 4.99 4.990000  4.99         362
    ## 311  3.99 3.99 3.990000  3.99         363
    ## 312  5.99 5.99 5.990000  5.99         364
    ## 313  5.99 4.99 5.490000 10.98         365
    ## 314  6.99 6.99 6.990000  6.99         366
    ## 315  2.99 0.99 1.990000  3.98         367
    ## 316  5.99 2.99 4.490000 17.96         368
    ## 317  7.99 0.99 4.740000 18.96         369
    ## 318  6.99 0.99 4.323333 25.94         371
    ## 319  2.99 2.99 2.990000  5.98         372
    ## 320  4.99 4.99 4.990000  4.99         373
    ## 321  2.99 0.99 1.656667  4.97         374
    ## 322  8.99 2.99 5.490000 21.96         375
    ## 323  0.99 0.99 0.990000  0.99         376
    ## 324  0.99 0.99 0.990000  0.99         378
    ## 325  4.99 4.99 4.990000  9.98         379
    ## 326  3.99 3.99 3.990000  3.99         380
    ## 327  2.99 0.99 2.323333  6.97         381
    ## 328  2.99 2.99 2.990000  5.98         382
    ## 329  8.99 0.99 4.990000  9.98         383
    ## 330  4.99 0.99 2.990000 11.96         384
    ## 331  4.99 2.99 3.990000  7.98         385
    ## 332  7.99 7.99 7.990000  7.99         386
    ## 333  7.99 3.99 5.490000 21.96         387
    ## 334  4.99 4.99 4.990000  9.98         388
    ## 335  4.99 4.99 4.990000  4.99         389
    ## 336  4.99 4.99 4.990000  9.98         390
    ## 337  7.99 2.99 4.990000 24.95         391
    ## 338  4.99 0.99 2.990000  5.98         393
    ## 339  3.99 2.99 3.490000  6.98         394
    ## 340  5.99 5.99 5.990000  5.99         396
    ## 341  0.99 0.99 0.990000  0.99         397
    ## 342  4.99 4.99 4.990000  4.99         398
    ## 343  6.99 4.99 5.990000 17.97         399
    ## 344  6.99 1.99 4.740000 18.96         400
    ## 345  4.99 1.99 3.990000 11.97         401
    ## 346  1.99 1.99 1.990000  1.99         402
    ## 347  2.99 0.99 1.990000  3.98         403
    ## 348  5.99 5.99 5.990000  5.99         404
    ## 349  4.99 2.99 3.990000  7.98         405
    ## 350  0.99 0.99 0.990000  0.99         406
    ## 351  7.99 7.99 7.990000  7.99         407
    ## 352  5.99 2.99 4.323333 12.97         408
    ## 353  6.99 6.99 6.990000  6.99         409
    ## 354  4.99 1.99 3.490000  6.98         411
    ## 355  4.99 0.99 2.740000 10.96         412
    ## 356  4.99 4.99 4.990000  9.98         413
    ## 357  4.99 3.99 4.490000  8.98         414
    ## 358  4.99 4.99 4.990000  4.99         415
    ## 359  3.99 0.99 2.656667  7.97         416
    ## 360  8.99 4.99 6.323333 18.97         417
    ## 361  2.99 2.99 2.990000  2.99         419
    ## 362  4.99 4.99 4.990000  4.99         420
    ## 363  0.99 0.99 0.990000  1.98         421
    ## 364  0.99 0.99 0.990000  0.99         422
    ## 365  0.99 0.99 0.990000  0.99         424
    ## 366  5.99 5.99 5.990000  5.99         425
    ## 367  0.99 0.99 0.990000  0.99         426
    ## 368  6.99 6.99 6.990000  6.99         427
    ## 369  4.99 4.99 4.990000  4.99         428
    ## 370  7.99 2.99 5.390000 26.95         429
    ## 371  4.99 2.99 3.990000  7.98         430
    ## 372  2.99 2.99 2.990000  2.99         431
    ## 373  8.99 5.99 7.656667 22.97         432
    ## 374 10.99 8.99 9.990000 19.98         433
    ## 375  5.99 5.99 5.990000  5.99         434
    ## 376  7.99 4.99 6.490000 12.98         435
    ## 377  7.99 3.99 5.990000 17.97         436
    ## 378  5.99 2.99 4.656667 13.97         437
    ## 379  6.99 0.99 4.323333 12.97         438
    ## 380  9.99 0.99 4.656667 13.97         439
    ## 381  4.99 4.99 4.990000  4.99         440
    ## 382  4.99 4.99 4.990000  4.99         441
    ## 383  6.99 0.99 4.656667 13.97         442
    ## 384  4.99 4.99 4.990000  4.99         443
    ## 385  8.99 0.99 4.990000  9.98         444
    ## 386  2.99 2.99 2.990000  5.98         445
    ## 387  4.99 0.99 2.323333  6.97         446
    ## 388  2.99 0.99 1.990000  3.98         447
    ## 389  4.99 2.99 3.990000  7.98         448
    ## 390  7.99 4.99 6.323333 18.97         449
    ## 391  3.99 3.99 3.990000  3.99         450
    ## 392  2.99 0.99 2.323333  6.97         451
    ## 393  2.99 1.99 2.656667  7.97         452
    ## 394  7.99 7.99 7.990000  7.99         454
    ## 395  0.99 0.99 0.990000  1.98         455
    ## 396  4.99 4.99 4.990000  4.99         456
    ## 397  7.99 7.99 7.990000  7.99         457
    ## 398  2.99 2.99 2.990000  2.99         459
    ## 399  4.99 0.99 2.990000 11.96         460
    ## 400  6.99 6.99 6.990000  6.99         461
    ## 401  3.99 2.99 3.490000  6.98         462
    ## 402  1.99 1.99 1.990000  1.99         463
    ## 403  3.99 1.99 2.990000  5.98         464
    ## 404  0.99 0.99 0.990000  0.99         465
    ## 405  2.99 2.99 2.990000  2.99         466
    ## 406  4.99 4.99 4.990000  4.99         467
    ## 407  6.99 0.99 4.190000 20.95         468
    ## 408  7.99 0.99 3.790000 18.95         469
    ## 409  2.99 2.99 2.990000  2.99         470
    ## 410  2.99 2.99 2.990000  2.99         471
    ## 411  4.99 0.99 2.490000  9.96         472
    ## 412  4.99 2.99 3.990000 11.97         473
    ## 413  7.99 7.99 7.990000  7.99         474
    ## 414  4.99 0.99 2.990000  5.98         475
    ## 415  4.99 2.99 3.990000  7.98         476
    ## 416  2.99 2.99 2.990000  2.99         477
    ## 417  7.99 3.99 5.990000 11.98         479
    ## 418  9.99 0.99 5.990000 17.97         480
    ## 419  5.99 5.99 5.990000  5.99         481
    ## 420  8.99 0.99 4.323333 12.97         482
    ## 421  6.99 6.99 6.990000  6.99         483
    ## 422  4.99 2.99 3.656667 10.97         484
    ## 423  2.99 2.99 2.990000  2.99         485
    ## 424  8.99 0.99 4.323333 12.97         486
    ## 425  4.99 2.99 3.990000  7.98         489
    ## 426  6.99 4.99 5.990000 11.98         490
    ## 427  2.99 0.99 1.990000  3.98         491
    ## 428  2.99 2.99 2.990000  2.99         492
    ## 429  7.99 7.99 7.990000  7.99         493
    ## 430  4.99 4.99 4.990000  4.99         494
    ## 431  4.99 4.99 4.990000  9.98         495
    ## 432  4.99 0.99 2.990000  5.98         496
    ## 433  7.99 7.99 7.990000  7.99         497
    ## 434  8.99 2.99 4.990000 14.97         498
    ## 435  2.99 2.99 2.990000  2.99         499
    ## 436  8.99 0.99 6.323333 18.97         500
    ## 437  1.99 0.99 1.490000  2.98         501
    ## 438  2.99 0.99 1.990000  7.96         502
    ## 439  5.99 1.99 3.990000 15.96         503
    ## 440  5.99 4.99 5.323333 15.97         504
    ## 441  2.99 2.99 2.990000  5.98         505
    ## 442  8.99 0.99 4.132857 28.93         506
    ## 443  4.99 0.99 2.990000  5.98         507
    ## 444  2.99 2.99 2.990000  5.98         508
    ## 445  8.99 4.99 6.990000 13.98         509
    ## 446  8.99 4.99 6.656667 19.97         510
    ## 447  3.99 2.99 3.490000  6.98         511
    ## 448  4.99 4.99 4.990000  4.99         513
    ## 449  4.99 4.99 4.990000  4.99         514
    ## 450  8.99 6.99 7.990000 15.98         515
    ## 451  3.99 1.99 2.990000  5.98         516
    ## 452  4.99 4.99 4.990000  4.99         517
    ## 453  2.99 2.99 2.990000  2.99         518
    ## 454  3.99 3.99 3.990000  3.99         519
    ## 455  6.99 6.99 6.990000  6.99         520
    ## 456  5.99 5.99 5.990000  5.99         522
    ## 457  4.99 0.99 2.990000  5.98         523
    ## 458  4.99 0.99 2.990000  5.98         524
    ## 459  5.99 5.99 5.990000  5.99         525
    ## 460  4.99 2.99 4.323333 12.97         526
    ## 461  5.99 0.99 3.590000 17.95         528
    ## 462  2.99 2.99 2.990000  2.99         529
    ## 463  0.99 0.99 0.990000  0.99         530
    ## 464  4.99 2.99 3.990000  7.98         531
    ## 465  2.99 2.99 2.990000  2.99         532
    ## 466  5.99 0.99 2.990000  8.97         533
    ## 467  5.99 0.99 3.490000  6.98         534
    ## 468  4.99 0.99 3.240000 12.96         535
    ## 469  6.99 0.99 3.990000  7.98         536
    ## 470  4.99 4.99 4.990000  4.99         537
    ## 471  4.99 2.99 3.990000  7.98         538
    ## 472  4.99 0.99 2.990000  5.98         539
    ## 473  7.99 4.99 6.490000 12.98         541
    ## 474  4.99 4.99 4.990000  9.98         542
    ## 475  6.99 1.99 4.490000  8.98         543
    ## 476  2.99 2.99 2.990000  5.98         544
    ## 477  3.99 0.99 2.490000  4.98         545
    ## 478  6.99 5.99 6.490000 12.98         546
    ## 479  8.99 0.99 3.990000 11.97         547
    ## 480  6.99 3.99 5.323333 15.97         548
    ## 481  4.99 0.99 3.740000 14.96         549
    ## 482  7.99 7.99 7.990000  7.99         550
    ## 483  7.99 0.99 4.190000 20.95         551
    ## 484  0.99 0.99 0.990000  0.99         552
    ## 485  4.99 4.99 4.990000  4.99         553
    ## 486  2.99 2.99 2.990000  5.98         554
    ## 487  5.99 0.99 3.656667 10.97         556
    ## 488  4.99 4.99 4.990000  9.98         557
    ## 489  2.99 2.99 2.990000  2.99         560
    ## 490  4.99 4.99 4.990000  9.98         561
    ## 491  5.99 2.99 3.990000 11.97         562
    ## 492  5.99 4.99 5.490000 10.98         563
    ## 493  5.99 2.99 4.490000  8.98         564
    ## 494  6.99 0.99 3.990000  7.98         565
    ## 495  5.99 4.99 5.490000 10.98         566
    ## 496  4.99 1.99 4.190000 20.95         569
    ## 497  7.99 7.99 7.990000  7.99         570
    ## 498  9.99 3.99 6.990000 13.98         571
    ## 499  7.99 7.99 7.990000  7.99         572
    ## 500  2.99 2.99 2.990000  2.99         573
    ## 501  0.99 0.99 0.990000  0.99         574
    ## 502  4.99 0.99 3.390000 16.95         575
    ## 503  2.99 0.99 1.990000  3.98         576
    ## 504  5.99 0.99 3.490000  6.98         577
    ## 505  0.99 0.99 0.990000  0.99         578
    ## 506  0.99 0.99 0.990000  0.99         580
    ## 507  4.99 4.99 4.990000  9.98         581
    ## 508  0.99 0.99 0.990000  0.99         582
    ## 509  4.99 4.99 4.990000 14.97         584
    ## 510  8.99 4.99 6.990000 13.98         586
    ## 511  4.99 0.99 2.990000  5.98         587
    ## 512  4.99 2.99 3.990000  7.98         588
    ## 513  4.99 0.99 3.656667 10.97         589
    ## 514  3.99 3.99 3.990000  3.99         590
    ## 515  8.99 2.99 5.990000 11.98         593
    ## 516  8.99 0.99 5.490000 21.96         594
    ## 517  6.99 6.99 6.990000  6.99         595
    ## 518  6.99 0.99 3.823333 22.94         596
    ## 519  8.99 2.99 5.990000 11.98         597
    ## 520  4.99 4.99 4.990000  4.99         599

## Exercise 7.2

### Modify the above query to only keep the customer\_ids that have more then 5 payments

``` r
dbGetQuery(con,"
SELECT MAX(amount) as max,
       MIN(amount) as min,
       AVG(amount) as avg,
       SUM(amount) as sum,
       COUNT(*) as count,
       customer_id
FROM payment
GROUP BY customer_id
HAVING COUNT(*)>5
")
```

    ##     max  min      avg   sum count customer_id
    ## 1  9.99 0.99 4.490000 26.94     6          19
    ## 2  9.99 0.99 4.490000 26.94     6          53
    ## 3  7.99 0.99 3.990000 27.93     7         109
    ## 4  5.99 0.99 2.990000 17.94     6         161
    ## 5  3.99 0.99 2.615000 20.92     8         197
    ## 6  6.99 0.99 2.990000 17.94     6         207
    ## 7  7.99 2.99 5.656667 33.94     6         239
    ## 8  8.99 0.99 4.823333 28.94     6         245
    ## 9  4.99 1.99 3.323333 19.94     6         251
    ## 10 6.99 0.99 3.156667 18.94     6         269
    ## 11 5.99 2.99 4.156667 24.94     6         274
    ## 12 6.99 0.99 4.323333 25.94     6         371
    ## 13 8.99 0.99 4.132857 28.93     7         506
    ## 14 6.99 0.99 3.823333 22.94     6         596

# Cleanup

### Run the following chunk to disconnect from the connection.

``` r
dbDisconnect(con)
```
